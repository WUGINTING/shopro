# 架構概覽

## 系統架構圖

```
┌─────────────────────────────────────────────────────────────────┐
│                         用戶端                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Web 瀏覽器  │  │   管理後台   │  │   官方網站   │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
└─────────┼─────────────────┼─────────────────┼──────────────────┘
          │                 │                 │
          └────────────────┬┼─────────────────┘
                          ││
                    ┌─────▼▼─────┐
                    │   Nginx    │  (反向代理/負載均衡)
                    └─────┬──────┘
                          │
┌─────────────────────────┼──────────────────────────────────────┐
│                    前端層 (Vue 3)                               │
│  ┌──────────────────────▼────────────────────────────────┐     │
│  │                  frontend/                             │     │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │     │
│  │  │  Views  │  │ Stores  │  │  API    │  │ Router  │  │     │
│  │  │ (頁面)  │  │ (狀態)  │  │ (服務)  │  │ (路由)  │  │     │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  │     │
│  └───────────────────────────────────────────────────────┘     │
└─────────────────────────┬──────────────────────────────────────┘
                          │ HTTP/REST API
                          │
┌─────────────────────────┼──────────────────────────────────────┐
│                   後端層 (Spring Boot)                          │
│  ┌──────────────────────▼────────────────────────────────┐     │
│  │                  E-commerce/                           │     │
│  │  ┌────────────────────────────────────────────────┐   │     │
│  │  │              Controller Layer                   │   │     │
│  │  │   (REST API 端點、請求驗證、回應格式)            │   │     │
│  │  └────────────────────┬───────────────────────────┘   │     │
│  │                       │                                │     │
│  │  ┌────────────────────▼───────────────────────────┐   │     │
│  │  │               Service Layer                     │   │     │
│  │  │      (業務邏輯、事務管理、資料轉換)              │   │     │
│  │  └────────────────────┬───────────────────────────┘   │     │
│  │                       │                                │     │
│  │  ┌────────────────────▼───────────────────────────┐   │     │
│  │  │              Repository Layer                   │   │     │
│  │  │         (JPA Repository、資料存取)              │   │     │
│  │  └────────────────────┬───────────────────────────┘   │     │
│  └───────────────────────┼───────────────────────────────┘     │
└─────────────────────────┬┼─────────────────────────────────────┘
                          ││
                          ││
┌─────────────────────────▼▼─────────────────────────────────────┐
│                      資料層                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌────────────────┐  │
│  │   MS SQL Server │  │   File Storage  │  │    Redis       │  │
│  │   (主要資料庫)   │  │   (檔案儲存)    │  │   (快取/可選)  │  │
│  └─────────────────┘  └─────────────────┘  └────────────────┘  │
└────────────────────────────────────────────────────────────────┘
                          │
                          │
┌─────────────────────────▼──────────────────────────────────────┐
│                     外部服務                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │  ECPay 綠界 │  │  LINE Pay   │  │ Google OAuth│            │
│  │   (金流)    │  │   (金流)    │  │   (認證)    │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└────────────────────────────────────────────────────────────────┘
```

## 技術棧

### 後端技術

| 技術 | 版本 | 用途 |
|------|------|------|
| Spring Boot | 3.4.1 | 核心框架 |
| Java | 17 | 程式語言 |
| Spring Data JPA | 3.4.1 | ORM 資料持久層 |
| Spring Security | 6.x | 安全認證 |
| JWT (JJWT) | 0.12.6 | Token 認證 |
| MS SQL Server | - | 關聯式資料庫 |
| Lombok | - | 簡化程式碼 |
| SpringDoc OpenAPI | 2.8.4 | API 文檔 |
| WebFlux | - | HTTP 客戶端 |
| Apache Commons Codec | 1.17.1 | 加密處理 |

### 前端技術

| 技術 | 版本 | 用途 |
|------|------|------|
| Vue | 3.5.25 | 前端框架 |
| TypeScript | 5.9.0 | 類型系統 |
| Vite | 7.2.4 | 建置工具 |
| Quasar | 2.18.6 | UI 框架 |
| Pinia | 3.0.4 | 狀態管理 |
| Vue Router | 4.6.3 | 路由管理 |
| Axios | 1.13.2 | HTTP 客戶端 |
| Vue I18n | 9.14.5 | 國際化 |
| Chart.js | 4.4.1 | 圖表視覺化 |

## 目錄結構

```
shopro/
├── E-commerce/                    # 後端專案 (Spring Boot)
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/info/ecommerce/
│   │   │   │   ├── common/              # 通用工具
│   │   │   │   ├── config/              # 系統配置
│   │   │   │   └── modules/             # 業務模組
│   │   │   │       ├── auth/            # 認證授權
│   │   │   │       ├── product/         # 商品管理
│   │   │   │       ├── order/           # 訂單管理
│   │   │   │       ├── crm/             # CRM
│   │   │   │       ├── payment/         # 支付整合
│   │   │   │       ├── marketing/       # 行銷活動
│   │   │   │       ├── store/           # 商店設定
│   │   │   │       ├── system/          # 系統設定
│   │   │   │       ├── album/           # 相冊管理
│   │   │   │       ├── calendar/        # 行事曆
│   │   │   │       ├── dashboard/       # 儀表板
│   │   │   │       ├── statistics/      # 統計報表
│   │   │   │       └── ads/             # 廣告追蹤
│   │   │   └── resources/
│   │   │       ├── application.properties
│   │   │       ├── application-dev.properties
│   │   │       └── application-prod.properties
│   │   └── test/
│   ├── pom.xml
│   └── .env.example
│
├── frontend/                      # 前端專案 (Vue 3)
│   ├── src/
│   │   ├── api/                   # API 服務層
│   │   ├── assets/                # 靜態資源
│   │   ├── components/            # Vue 組件
│   │   ├── composables/           # 組合式函數
│   │   ├── layouts/               # 佈局組件
│   │   ├── locale/                # 國際化
│   │   ├── router/                # 路由配置
│   │   ├── stores/                # Pinia 狀態管理
│   │   ├── styles/                # 樣式文件
│   │   ├── utils/                 # 工具函數
│   │   ├── views/                 # 頁面視圖
│   │   ├── App.vue
│   │   └── main.ts
│   ├── package.json
│   └── vite.config.ts
│
├── frontend-official/             # 官網前端
├── docs/                          # 技術文檔
└── README.md
```

## 模組概覽

### 後端模組 (13 個)

| 模組 | 說明 | 主要功能 |
|------|------|----------|
| auth | 認證授權 | 登入、註冊、JWT、Google OAuth |
| product | 商品管理 | 商品 CRUD、分類、規格、庫存 |
| order | 訂單管理 | 訂單處理、出貨、折扣、問答 |
| crm | 顧客關係管理 | 會員、等級、積點、EDM |
| payment | 支付整合 | ECPay、LINE Pay、退款 |
| marketing | 行銷活動 | 優惠券、促銷、活動 |
| store | 商店設定 | 門市、首頁區塊、員工 |
| system | 系統設定 | 基本設定、金流物流、通知 |
| album | 相冊管理 | 相冊、圖片上傳 |
| calendar | 行事曆 | 事件管理、排程 |
| dashboard | 儀表板 | 統計總覽 |
| statistics | 統計報表 | 銷售、庫存、業績 |
| ads | 廣告追蹤 | GA4、Pixel、追蹤碼 |

### 前端頁面 (31 個)

按功能分類：

**核心頁面**
- 首頁 (儀表板)
- 登入
- 個人資料
- 404

**商品模組**
- 商品管理
- 分類管理

**訂單模組**
- 訂單管理
- 訂單折扣
- 訂單問答

**CRM 模組**
- 客戶管理
- 會員管理
- 會員等級
- 會員群組
- 積點管理
- 部落格
- EDM

**行銷模組**
- 行銷活動
- 促銷活動

**支付模組**
- 支付儀表板
- 支付交易
- 支付設定
- 綠界配置
- 回調日誌

**其他模組**
- 相冊管理
- 行事曆
- 統計報表
- 系統設定
- 操作日誌
- 使用者管理

## 資料流

### 認證流程

```
1. 用戶輸入帳密
   ↓
2. POST /api/auth/login
   ↓
3. 驗證帳密 (AuthService)
   ↓
4. 生成 JWT Token (JwtService)
   ↓
5. 回傳 { token, user }
   ↓
6. 前端儲存至 localStorage
   ↓
7. 後續請求攜帶 Authorization Header
```

### 訂單處理流程

```
1. 用戶提交訂單
   ↓
2. 驗證商品庫存
   ↓
3. 計算金額與折扣
   ↓
4. 建立訂單
   ↓
5. 扣減庫存
   ↓
6. 發送訂單確認通知
   ↓
7. 導向支付頁面
```

### 支付流程

```
1. 選擇支付方式
   ↓
2. 產生支付請求
   ↓
3. 導向第三方支付
   ↓
4. 完成支付
   ↓
5. 回調驗證
   ↓
6. 更新訂單狀態
   ↓
7. 觸發出貨流程
```

## 安全架構

### 認證機制

- **JWT Token** - 無狀態認證
- **Token 過期時間** - 預設 24 小時
- **密碼加密** - BCrypt

### 權限控制 (RBAC)

| 角色 | 權限範圍 |
|------|----------|
| ADMIN | 所有功能 |
| MANAGER | 大部分管理功能 |
| STAFF | 基本業務功能 |
| CUSTOMER | 基本檢視 |

### 安全配置

- CORS 跨域限制
- HTTPS 強制 (生產環境)
- SQL 注入防護 (JPA)
- XSS 防護 (前端驗證)

## 擴展性設計

### 水平擴展

- 無狀態後端服務
- 可部署多實例
- 負載均衡支援

### 垂直擴展

- 模組化設計
- 低耦合
- 可獨立擴展各模組

### 未來擴展方向

- Redis 快取整合
- 訊息佇列 (RabbitMQ/Kafka)
- 微服務拆分
- 多租戶支援

# --------------------------------------------------
# SEO 優化後的 Nginx 設定檔 - RTSP to HLS 串流服務
# --------------------------------------------------

# 將所有 HTTP 請求永久重定向到 HTTPS (非 www 版本)
server {
    listen 80;
    server_name www.shenyuans.com shenyuans.com;
    return 301 https://www.shenyuans.com$request_uri;
}

# 主要的 HTTPS 伺服器區塊
server {
    listen 443 ssl http2;
    server_name www.shenyuans.com;

    # --- SSL 設定 ---
    ssl_certificate         E:/nginx-1.22.0/ssl/server.pem;
    ssl_certificate_key     E:/nginx-1.22.0/ssl/server.key;
    ssl_protocols           TLSv1.2 TLSv1.3;
    ssl_ciphers             'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256';
    ssl_prefer_server_ciphers off;

    # --- 安全性標頭 (HSTS) ---
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # --- 網站根目錄 ---
    root E:/nginx-1.22.0/html/rtsp_hls_web/;
    index index.html index.htm;

    # --- Gzip 壓縮 ---
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript image/svg+xml;

    # --- 主 Location (處理靜態頁面) ---
    location / {
        try_files $uri $uri/ /index.html;
    }

    # --- 允許 Google 抓取 robots.txt 和 sitemap.xml ---
    location = /robots.txt {
        root E:/nginx-1.22.0/html/rtsp_hls_web/;
        access_log off;
    }

    location = /sitemap.xml {
        root E:/nginx-1.22.0/html/rtsp_hls_web/;
        access_log off;
    }

    # --- 靜態資源快取 ---
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # --- 自訂 404 頁面 ---
    error_page 404 /index.html;
}
